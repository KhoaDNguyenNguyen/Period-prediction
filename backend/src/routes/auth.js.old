import express from 'express';
import { registerUser, loginUser } from '../controllers/authController.js';
import passport from '../config/passport.js';  
import { generateToken } from '../utils/jwt.js'; 
import { CLIENT_URL } from '../config/constants.js';

const router = express.Router();

// User registration route
router.post('/register', registerUser);

// User login route
router.post('/login', loginUser);

passport.authenticate('google', {
  scope: ['profile', 'email'],
  prompt: 'select_account',
  session: false
});

router.get('/google/callback', passport.authenticate('google', { session: false }), 
(req, res) => {
    const token = generateToken(req.user);

    res.redirect(`${CLIENT_URL}/index.html?token=${token}`);
});

router.get('/facebook', passport.authenticate('facebook', { scope: ['email'] }));
router.get('/facebook/callback', passport.authenticate('facebook', { session: false }), (req, res) => {
    const token = req.user.token;
    res.redirect(`${CLIENT_URL}/index.html?token=${token}`);
});

router.get('/github', passport.authenticate('github', { scope: ['user:email'] }));
router.get('/github/callback', passport.authenticate('github', { session: false }), (req, res) => {
    const token = req.user.token; 
    res.redirect(`${CLIENT_URL}/index.html?token=${token}`);
});

router.get('/linkedin', passport.authenticate('linkedin', { scope: ['r_liteprofile', 'r_emailaddress'] }));
router.get('/linkedin/callback', passport.authenticate('linkedin', { session: false }), (req, res) => {
    const token = req.user.token;
    res.redirect(`${CLIENT_URL}/index.html?token=${token}`);
});

export default router;